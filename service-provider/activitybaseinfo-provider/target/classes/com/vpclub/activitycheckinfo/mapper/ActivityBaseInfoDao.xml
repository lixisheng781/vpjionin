<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.huake.modules.app.dao.ActivityBaseInfoDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.huake.modules.app.entity.ActivityBaseInfoEntity" id="activityBaseInfoMap">
        <result property="abiNum" column="abi_num"/>
        <result property="ubiId" column="ubi_id"/>
        <result property="abiName" column="abi_name"/>
        <result property="abiCategory" column="abi_category"/>
        <result property="abiSponsor" column="abi_sponsor"/>
        <result property="abiOrganizer" column="abi_organizer"/>
        <result property="pid" column="pid"/>
        <result property="abiPurpose" column="abi_purpose"/>
        <result property="abiDescription" column="abi_description"/>
        <result property="imgUrl" column="img_url"/>
        <result property="bannerUrl" column="banner_url"/>
        <result property="fileUrl" column="file_url"/>
        <result property="abiStartTime" column="abi_start_time"/>
        <result property="abiEndTime" column="abi_end_time"/>
        <result property="abiRegistrationDeadline" column="abi_registration_deadline"/>
        <result property="limitSignNum" column="limit_sign_num"/>
        <result property="abiSignNum" column="abi_sign_num"/>
        <result property="abiEnrollmentNum" column="abi_enrollment_num"/>
        <result property="abiCheckNum" column="abi_check_num"/>
        <result property="abiMinBudget" column="abi_min_budget"/>
        <result property="abiMaxBudget" column="abi_max_budget"/>
        <result property="abiGpsPlace" column="abi_gps_place"/>
        <result property="abiGpsLng" column="abi_gps_lng"/>
        <result property="abiGpsLat" column="abi_gps_lat"/>
        <result property="abiDetailedInfo" column="abi_detailed_info"/>
        <result property="abiWeight" column="abi_weight"/>
        <result property="abiWeightDate" column="abi_weight_date"/>
        <result property="haveExpenses" column="have_expenses"/>
        <result property="allowComment" column="allow_comment"/>
        <result property="commentAudit" column="comment_audit"/>
        <result property="abiSignOpen" column="abi_sign_open"/>
        <result property="auditStatus" column="audit_status"/>
        <result property="auditTime" column="audit_time"/>
        <result property="auditContent" column="audit_content"/>
        <result property="abiStatus" column="abi_status"/>
        <result property="sriId" column="sri_id"/>
        <result property="sortno" column="sortno"/>
        <result property="abiChargeName" column="abi_charge_name"/>
        <result property="abiChargeNo" column="abi_charge_no"/>
        <result property="abiChargeMobile" column="abi_charge_mobile"/>
        <result property="abiSupervisorName" column="abi_supervisor_name"/>
        <result property="abiSupervisorMobile" column="abi_supervisor_mobile"/>
        <result property="delFlag" column="del_flag"/>
        <result property="createDate" column="create_date"/>
        <result property="createId" column="create_id"/>
        <result property="createName" column="create_name"/>
        <result property="updateDate" column="update_date"/>
        <result property="updateId" column="update_id"/>
        <result property="updateName" column="update_name"/>
        <result property="abiRangeType" column="abi_range_type"/>
        <result property="abiRangeId" column="abi_range_id"/>
        <result property="abiPublishType" column="abi_publish_type"/>
        <result property="abiPublishId" column="abi_publish_id"/>
        <result property="signStartTime" column="sign_start_time"/>
        <result property="isCanCancel" column="is_can_cancel"/>
        <result property="signinType" column="signin_type"/>
        <result property="signinStartTime" column="signin_start_time"/>
        <result property="signinEndTime" column="signin_end_time"/>
        <result property="signoutType" column="signout_type"/>
        <result property="signoutStartTime" column="signout_start_time"/>
        <result property="signoutEndTime" column="signout_end_time"/>
        <result property="remindTime" column="remind_time"/>
        <result property="remindTimes" column="remind_times"/>
        <result property="remindContent" column="remind_content"/>
        <result property="auditTimes" column="audit_times"/>
        <result property="abiSignoutNum" column="abi_signout_num"/>
        <result property="isArtificialMark" column="is_artificial_mark"/>
        <result property="maxSignTimes" column="max_sign_times"/>
        <result property="mustSignTimes" column="must_sign_times"/>
        <result property="currentSignTime" column="current_sign_time"/>
        <result property="abiValidHour" column="abi_valid_hour"/>
        <result property="abiType" column="abi_type"/>
        <result property="abiScore" column="abi_score"/>
        <result property="joinScore" column="join_score"/>
        <result property="abiUpstandardNum" column="abi_upstandard_num"/>
        <result property="abiGrade" column="abi_grade"/>
        <result property="commentUserCount" column="comment_user_count"/>
        <result property="abiSignRequire" column="abi_sign_require"/>
        <result property="creditFlag" column="credit_flag"/>
        <result property="abiCosponsor" column="abi_cosponsor"/>
        <result property="asiId" column="asi_id"/>
        <result property="abiProperty" column="abi_property"/>
        <result property="publicStatus" column="public_status"/>
        <result property="publicStartTime" column="public_start_time"/>
        <result property="publicEndTime" column="public_end_time"/>
        <result property="publicPeriod" column="public_period"/>
        <result property="pbiType" column="pbi_type"/>
    </resultMap>

    <!-- 判断是否能报名-->
    <select id="isSignup" parameterType="map" resultType="com.huake.modules.app.entity.ActivityBaseInfoEntity">
        SELECT *
        FROM activity_base_info
        WHERE abi_num = #{abiNum}
              AND abi_status = 1
              AND del_flag = 0
    </select>


    <update id="updateApply">
        UPDATE activity_base_info
        SET abi_sign_num = abi_sign_num + 1, abi_enrollment_num = abi_enrollment_num + 1
        WHERE abi_num = #{activityId}

        <![CDATA[
              AND
              abi_sign_num < limit_sign_num
              AND
              abi_enrollment_num < limit_sign_num
        ]]>

    </update>
</mapper>